<link rel="import" href="../bower_components/ace-element/ace-element.html">
<link rel="import" href="../bower_components/polymer-flex-layout/polymer-flex-layout.html">
<link rel="import" href="../bower_components/polymer-ui-splitter/polymer-ui-splitter.html">

<link rel="import" href="/components/ele-preview.html">

<script src="../bower_components/lodash/dist/lodash.js"></script>

<polymer-element name="ele-workspace">
  <template>
    <pvc-globals id="globals" values="[[globals]]"></pvc-globals>
    <polymer-flex-layout></polymer-flex-layout>
    <panel id="sourceContainer">
      <div class="card"><ace-element id="elementEditor" theme="clouds" mode="html" tabSize="2" on-editor-input="{{updateName}}">{{globals.package.files[globals.package.name + '.html']}}</ace-element></div>
    </panel>
    <polymer-ui-splitter direction="left"></polymer-ui-splitter>
    <section flex>
      <polymer-flex-layout vertical></polymer-flex-layout>
      <panel id="previewContainer">
        <ele-preview class="card" 
          demo="{{$.demoEditor}}" 
          element="{{$.elementEditor}}">
        </ele-preview>
      </panel>
      <polymer-ui-splitter direction="up"></polymer-ui-splitter>
      <panel flex id="demoContainer">
        <div class="card"><ace-element id="demoEditor" theme="clouds" mode="html" tabSize="2">{{globals.package.files['demo.html']}}</ace-element></div>
      </panel>
    </section>
    
    <style>
      :host { height: 100%; }
      
      panel {
        display: block;
        overflow: hidden;
        position: relative;
        padding: 20px;
      }
      
      ace-element { width: 100%; height: 100%; }
      
      .card {
        background: white;
        box-shadow: 0 3px 8px rgba(0,0,0,0.2);
        position: absolute;
        width: calc(100% - 25px);
        height: calc(100% - 25px);
        top: 20px;
        left: 5px;
      }

      #sourceContainer {
        width: 50%;
        padding-right: 5px;
      }
      
      #sourceContainer .card {
        left: 20px;
        width: calc(100% - 25px);
        height: calc(100% - 40px);
      }

      #demoContainer {
      }
      #demoContainer .card {
        top: 5px;
      }

      #previewContainer {
        height: 400px;
      }
      
      polymer-ui-splitter {
        box-shadow: none;
        background-color: transparent;
      }
      
      polymer-ui-splitter:hover {
        background-color: #e5e5e5;
      }
    </style>
  </template>
  
  <script>
    (function() {
      var NAME_REGEX = /<polymer-element.* name=['"]([a-z0-9-]+)['"]/i
    
      Polymer('ele-workspace', {
        updateName: _.debounce(function() {
          var source = this.$.elementEditor.editorValue;
          var match = source.match(NAME_REGEX);
          if (match && match[1]) {
            this.globals.package.name = match[1].trim();
          }
        }, 1000)
      });
    })();
  </script>
</polymer-element>